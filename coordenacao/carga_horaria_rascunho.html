<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Carga Horária</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
        * {
            cursor: pointer;
        }
        table td, table td * {
            vertical-align: top;
        }
    </style>
    <script type="text/javascript">
        const SEPARADOR = ",";        

        var cargaHorariaPorProfessor = [];
        var vetDisciplina = [];

        function converter(minutos) {
            // const horas = Math.floor(minutos / 60);
            const horas = parseInt(minutos/60);
            const min = parseInt(minutos % 60);
            const textoHoras = (`00${horas}`).slice(-2);
            const textoMinutos = (`00${min}`).slice(-2);
            return `${textoHoras}:${textoMinutos}`;
        }

        function exportar(){
            var wnd = window.open("about:blank", "", "_blank");
            var csv = "";
            for (let index = 0; index < vetDisciplina.length; index++) {    
                csv += vetDisciplina[index].nome+";"+((document.getElementById(index).options[document.getElementById(index).selectedIndex].value.trim() != '') ? document.getElementById(index).options[document.getElementById(index).selectedIndex].value.trim() : "PENDENTE")+";<br>";
            }            
            for (var professor in cargaHorariaPorProfessor) {
                csv += professor+";"+converter(cargaHorariaPorProfessor[professor])+";<br>";
            }               
            wnd.document.write(csv);            
        }

        function atualizarCargaPorProfessor() {
            var html = "";
            // var html = "<h1> extrato </h1>";
            html += "<table border='1'>";
            for (var professor in cargaHorariaPorProfessor) {
                var total = cargaHorariaPorProfessor[professor];
                html += "<tr> <td>" + professor + "</td><td>" + converter(total) + "</td> </tr>";
            }
            html += "</table><button onclick='exportar()'> Exportar CSV </button>";
            document.getElementById("tabela").innerHTML = html;
        }

        function computa() {   
            cargaHorariaPorProfessorAux = [];            
            for (var professor in cargaHorariaPorProfessor) {
                cargaHorariaPorProfessorAux[professor] = 0;
            }
            cargaHorariaPorProfessor = [];
            cargaHorariaPorProfessor = cargaHorariaPorProfessorAux;

            for (let index = 0; index < vetDisciplina.length; index++) {    
                if (document.getElementById(index).options[document.getElementById(index).selectedIndex].value.trim() != ""){
                    cargaHorariaPorProfessor[document.getElementById(index).options[document.getElementById(index).selectedIndex].value.trim()] += 
                    vetDisciplina[index].creditos * vetDisciplina[index].duracaoPorCredito;                
                }
            }
            atualizarCargaPorProfessor();
        }

        function adicionarNovaDisciplina(){
            var novo_nome = document.getElementById('novo_nome').value;
            var creditos = parseInt(document.getElementById('novo_creditos').value);
            var duracao = parseInt(document.getElementById('novo_duracao').value);
            let disciplina = {
                    "nome": novo_nome,
                    "creditos": creditos,
                    "duracaoPorCredito": duracao
            }
            vetDisciplina.push(disciplina);

            var table = document.getElementById('delegacao');
            // Create an empty <tr> element and add it to the 1st position of the table:
            var row = table.insertRow(0);
            // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);

            // Add some text to the new cells:
            cell1.innerHTML = novo_nome;
            
            var html_professor = "<select id='"+parseInt(vetDisciplina.size-1)+"' onchange='computa()'> </select>";
            html_professor += "<option value=''> </option>";
            for (var professor in cargaHorariaPorProfessor) {
                html_professor += "<option value='" + professor + "'>" + professor + "</option>";
            }
            html_professor += "</select>";
            cell2.innerHTML = html_professor;
        }

        function carregar() {
            var html_professor1 = "<option value=''> </option>";
            var array = document.getElementById("vetProfessor").value.split("\n");
            for (let index = 0; index < array.length - 1; index++) {
                cargaHorariaPorProfessor[array[index]] = 0;
                html_professor1 += "<option value='" + array[index] + "'>" + array[index] + "</option>";
            }
            var array = document.getElementById("vetDisciplina").value.split("\n");
            for (let index = 0; index < array.length - 1; index++) {
                var aux = array[index].split(SEPARADOR);
                let disciplina = {
                    "nome": aux[0],
                    "creditos": parseInt(aux[1]),
                    "duracaoPorCredito": parseInt(aux[2])
                }
                vetDisciplina.push(disciplina);
            }
            var html = "<table id='delegacao' border='1'>";
            var html_professor2 = "";
            for (let index = 0; index < vetDisciplina.length; index++) {
                html_professor2 = "<select id='"+index+"' onchange='computa()'>" + html_professor1 + "</select>";
                html += "<tr> <td>" + vetDisciplina[index].nome + "</td><td>" + html_professor2 + "</td></tr>";
                html_professor2 = "";
            }
            html +="<tr> <td> <input type='text' id='novo_nome'> <input type='text' id='novo_creditos'>  <input type='text' id='novo_duracao'> </td> <td> <button onclick=adicionarNovaDisciplina()>Disciplina </button> </td> </tr>";  
            html += "</table>";
            document.getElementById("sistema").innerHTML = html;
            document.getElementById("formato_professor").style = "display: none;";
            document.getElementById("formato_disciplina").style = "display: none;";
            document.getElementById("vetProfessor").style = "display: none;";
            document.getElementById("vetDisciplina").style = "display: none;";
            document.getElementById("btn_carregar").style = "display: none;";
        }
    </script>
</head>
<body>
    <h1>Disciplinas do Semestre</h1>
    <h2 id="formato_disciplina">Formato Disciplina: nome,créditos,duração por crédito (em minutos)<br></h2>
    <h2 id="formato_professor">Formato Professor: Usar nomes únicos<br></h2>
    <!-- <button id="btn_carregar" onclick="carregar()">Carregar (Professores e Disciplinas)</button> <br> -->
    <table>
        <tr>
            <td>
                <textarea id="vetProfessor" rows="50" cols="10">
IGOR
MARCIO
LUCIANO
RAQUEL
TELECKEN
BRIÃO
CIBELE
FLÁVIA
FRITZEN
OUTROS
                </textarea>
            </td>
            <td>
                <textarea id="vetDisciplina" rows="50" cols="50">
Fundamentos da Computação,4,50
Fundamentos da Interação Humano computador,2,50
Lógica de Programação,6,50
Matemática Básica,2,50
Sistemas de Informação,4,50
Tópicos em Tecnologia e Sociedade,2,50
Design de Interfaces,4,50
Engenharia de Software,4,50
Fundamentos de Matemática Discreta,4,50
Organização de Computadores,2,50
Programação Modular,4,50
Projeto e Modelagem de Banco de Dados,2,50
Análise e Projeto de Software,4,50
Design de Interação,4,50
Fundamentos de Estatística Exploratória,2,50
Implementação e Operação de Bancos de Dados,4,50
Programação Orientada a Objetos,4,50
Sistemas Operacionais,2,50
Desenvolvimento de Aplicativos Web I,4,50
Estruturas de Dados ,4,50
Fundamentos de Inferência Estatística,2,50
Gerencia de Projetos,4,50
Princípios e Padrões de Projeto,4,50
Programação em Bancos de Dados,2,50
Desenvolvimento de Aplicativos Web II,4,50
Empreendimentos Empresariais,4,50
Metodologia Científica,2,50
Princípios e Padrões de Arquitetura,4,50
Qualidade de Software,2,50
Redes de Computadores,4,50
Seminários(Trabalho de Conclusão de Curso),10,50
Tópicos em Ciência da Computação,2,50
Tópicos em Desenvolvimento de Sistemas,2,50
Tópicos em Desenvolvimento de Aplicativos,2,50
Tópicos em Análise de Sistemas,2,50
Tópicos em Bancos de Dados,2,50
Lógica de Programação,4,60
Lógica de Programação,4,60
Fundamentos da Computação,2,60
Fundamentos da Computação,2,60
Desenvolvimento Baseado em Objetos,2,60
Bancos de Dados,4,60
Engenharia de Software,3,60
Desenvolvimento de Sistemas I,4,60
Desenvolvimento de Sistemas II,4,60
                </textarea>
            </td>
            <td id="sistema">

            </td>
            <td id="tabela">

            </td>
        </tr>
        <!-- <tr>
            <td> -->
                <!-- <button id="btn_carregar" onclick="carregar()">Carregar (Professores e Disciplinas)</button> -->
            <!-- </td>
        </tr> -->
    </table>
    <button id="btn_carregar" onclick="carregar()">Carregar (Professores e Disciplinas)</button>

</body>
</html>